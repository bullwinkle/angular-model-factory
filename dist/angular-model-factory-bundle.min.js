/**
 * modelFactory makes working with RESTful APIs in AngularJS easy
 * @version v1.0.4 - 2018-04-07
 * @link http://swimlane.github.io/angular-model-factory/
 * @author Austin McDaniel <amcdaniel2@gmail.com>, Juri Strumpflohner <juri.strumpflohner@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(h){"use strict";var e,t,n=[];function r(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function i(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function d(e,t,n){d.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function g(e,t){g.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function v(e,t){v.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function b(e,t,n){b.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function m(e,t,n){var r=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r),e}function y(r,i,a,s,e,t,o){var u=(e=e||[]).slice(0);if(void 0!==t){if(s&&s(u,t))return;u.push(t)}var n=typeof r,f=typeof i;if("undefined"===n)"undefined"!==f&&a(new g(u,i));else if("undefined"===f)a(new v(u,r));else if(n!==f)a(new d(u,r,i));else if(r instanceof Date&&i instanceof Date&&r-i!=0)a(new d(u,r,i));else if("object"===n&&null!==r&&null!==i){if((o=o||[]).indexOf(r)<0){if(o.push(r),Array.isArray(r)){var l;r.length;for(l=0;l<r.length;l++)l>=i.length?a(new b(u,l,new v(h,r[l]))):y(r[l],i[l],a,s,u,l,o);for(;l<i.length;)a(new b(u,l,new g(h,i[l++])))}else{var c=Object.keys(r),p=Object.keys(i);c.forEach(function(e,t){var n=p.indexOf(e);0<=n?(y(r[e],i[e],a,s,u,e,o),p=m(p,n)):y(r[e],h,a,s,u,e,o)}),p.forEach(function(e){y(h,i[e],a,s,u,e,o)})}o.length=o.length-1}}else r!==i&&("number"===n&&isNaN(r)&&isNaN(i)||a(new d(u,r,i)))}function a(e,t,n,r){return r=r||[],y(e,t,function(e){e&&r.push(e)},n),r.length?r:h}function s(e,t,n){if(e&&t&&n&&n.kind){for(var r=e,i=-1,a=n.path.length-1;++i<a;)void 0===r[n.path[i]]&&(r[n.path[i]]="number"==typeof n.path[i]?new Array:{}),r=r[n.path[i]];switch(n.kind){case"A":!function e(t,n,r){if(r.path&&r.path.length){var i,a=t[n],s=r.path.length-1;for(i=0;i<s;i++)a=a[r.path[i]];switch(r.kind){case"A":e(a[r.path[i]],r.index,r.item);break;case"D":delete a[r.path[i]];break;case"E":case"N":a[r.path[i]]=r.rhs}}else switch(r.kind){case"A":e(t[n],r.index,r.item);break;case"D":t=m(t,n);break;case"E":case"N":t[n]=r.rhs}return t}(r[n.path[i]],n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}}e="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},(t=e.DeepDiff)&&n.push(function(){void 0!==t&&e.DeepDiff===a&&(e.DeepDiff=t,t=h)}),r(d,i),r(g,i),r(v,i),r(b,i),Object.defineProperties(a,{diff:{value:a,enumerable:!0},observableDiff:{value:y,enumerable:!0},applyDiff:{value:function(t,n,r){t&&n&&y(t,n,function(e){r&&!r(t,n,e)||s(t,n,e)})},enumerable:!0},applyChange:{value:s,enumerable:!0},revertChange:{value:function(e,t,n){if(e&&t&&n&&n.kind){var r,i,a=e;for(i=n.path.length-1,r=0;r<i;r++)void 0===a[n.path[r]]&&(a[n.path[r]]={}),a=a[n.path[r]];switch(n.kind){case"A":!function e(t,n,r){if(r.path&&r.path.length){var i,a=t[n],s=r.path.length-1;for(i=0;i<s;i++)a=a[r.path[i]];switch(r.kind){case"A":e(a[r.path[i]],r.index,r.item);break;case"D":case"E":a[r.path[i]]=r.lhs;break;case"N":delete a[r.path[i]]}}else switch(r.kind){case"A":e(t[n],r.index,r.item);break;case"D":case"E":t[n]=r.lhs;break;case"N":t=m(t,n)}return t}(a[n.path[r]],n.index,n.item);break;case"D":case"E":a[n.path[r]]=n.lhs;break;case"N":delete a[n.path[r]]}}},enumerable:!0},isConflict:{get:function(){return void 0!==t},enumerable:!0},noConflict:{value:function(){return n&&(n.forEach(function(e){e()}),n=null),a},enumerable:!0}}),"undefined"!=typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=a:e.DeepDiff=a}(),function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.UriTemplate=t()}(this,function(){var p={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},h={"*":!0};function d(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function u(e){var t="";p[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var g="",v="",b=!0,m=!1,f=!1;"+"==t?b=!1:"."==t?g=v=".":"/"==t?g=v="/":"#"==t?b=!(v="#"):";"==t?(g=v=";",f=m=!0):"?"==t?(v="?",g="&",m=!0):"&"==t&&(g=v="&",m=!0);for(var n=[],r=e.split(","),y=[],$={},i=0;i<r.length;i++){var a=r[i],s=null;if(-1!=a.indexOf(":")){var o=a.split(":");a=o[0],s=parseInt(o[1])}for(var u={};h[a.charAt(a.length-1)];)u[a.charAt(a.length-1)]=!0,a=a.substring(0,a.length-1);var l={truncate:s,name:a,suffices:u};y.push(l),$[a]=l,n.push(a)}var c=function(e){for(var t="",n=0,r=0;r<y.length;r++){var i=y[r],a=e(i.name);if(null==a||Array.isArray(a)&&0==a.length||"object"==typeof a&&0==Object.keys(a).length)n++;else if(t+=r==n?v:g||",",Array.isArray(a)){m&&(t+=i.name+"=");for(var s=0;s<a.length;s++)0<s&&(t+=i.suffices["*"]&&g||",",i.suffices["*"]&&m&&(t+=i.name+"=")),t+=b?encodeURIComponent(a[s]).replace(/!/g,"%21"):d(a[s])}else if("object"==typeof a){m&&!i.suffices["*"]&&(t+=i.name+"=");var o=!0;for(var u in a)o||(t+=i.suffices["*"]&&g||","),o=!1,t+=b?encodeURIComponent(u).replace(/!/g,"%21"):d(u),t+=i.suffices["*"]?"=":",",t+=b?encodeURIComponent(a[u]).replace(/!/g,"%21"):d(a[u])}else m&&(t+=i.name,f&&""==a||(t+="=")),null!=i.truncate&&(a=a.substring(0,i.truncate)),t+=b?encodeURIComponent(a).replace(/!/g,"%21"):d(a)}return t};return c.varNames=n,{prefix:v,substitution:c,unSubstitution:function(e,t){if(v){if(e.substring(0,v.length)!=v)return null;e=e.substring(v.length)}if(1==y.length&&y[0].suffices["*"]){for(var n=(d=y[0]).name,r=d.suffices["*"]?e.split(g||","):[e],i=b&&-1!=e.indexOf("="),a=1;a<r.length;a++)e=r[a],i&&-1==e.indexOf("=")&&(r[a-1]+=(g||",")+e,r.splice(a,1),a--);for(a=0;a<r.length;a++){e=r[a],b&&-1!=e.indexOf("=")&&(i=!0);for(var s=e.split(","),o=0;o<s.length;o++)b&&(s[o]=decodeURIComponent(s[o]));1==s.length?r[a]=s[0]:r[a]=s}if(m||i){var u=t[n]||{};for(o=0;o<r.length;o++){var f=e;if(!m||f){if("string"==typeof r[o]){var l=(e=r[o]).split("=",1)[0];f=e=e.substring(l.length+1)}else l=(e=r[o][0]).split("=",1)[0],e=e.substring(l.length+1),r[o][0]=e,f=r[o];void 0!==u[l]?Array.isArray(u[l])?u[l].push(f):u[l]=[u[l],f]:u[l]=f}}1==Object.keys(u).length&&void 0!==u[n]?t[n]=u[n]:t[n]=u}else void 0!==t[n]?Array.isArray(t[n])?t[n]=t[n].concat(r):t[n]=[t[n]].concat(r):1!=r.length||d.suffices["*"]?t[n]=r:t[n]=r[0]}else{r=1==y.length?[e]:e.split(g||",");var c={};for(a=0;a<r.length;a++){for(var p=0;p<y.length-1&&p<a&&!y[p].suffices["*"];p++);if(p!=a){for(var h=y.length-1;0<h&&y.length-h<r.length-a&&!y[h].suffices["*"];h--);y.length-h!=r.length-a?c[a]=p:c[a]=h}else c[a]=a}for(a=0;a<r.length;a++)if((e=r[a])||!m){if(s=e.split(","),i=!1,m){n=(e=s[0]).split("=",1)[0],e=e.substring(n.length+1),s[0]=e;var d=$[n]||y[0]}else n=(d=y[c[a]]).name;for(o=0;o<s.length;o++)b&&(s[o]=decodeURIComponent(s[o]));(m||d.suffices["*"])&&void 0!==t[n]?Array.isArray(t[n])?t[n]=t[n].concat(s):t[n]=[t[n]].concat(s):1!=s.length||d.suffices["*"]?t[n]=s:t[n]=s[0]}}}}}function g(e){if(!(this instanceof g))return new g(e);for(var t=e.split("{"),f=[t.shift()],l=[],i=[],c=[],n=[];0<t.length;){var r=t.shift(),a=r.split("}")[0],s=r.substring(a.length+1),o=u(a);i.push(o.substitution),c.push(o.unSubstitution),l.push(o.prefix),f.push(s),n=n.concat(o.substitution.varNames)}this.fill=function(e){if(e&&"function"!=typeof e){var t=e;e=function(e){return t[e]}}for(var n=f[0],r=0;r<i.length;r++){n+=(0,i[r])(e),n+=f[r+1]}return n},this.fromUri=function(e){for(var t={},n=0;n<f.length;n++){var r=f[n];if(e.substring(0,r.length)!==r)return;if(e=e.substring(r.length),n>=f.length-1){if(""==e)break;return}for(var i=f[n+1],a=n;;){if(a==f.length-2){var s=e.substring(e.length-i.length);if(s!==i)return;var o=e.substring(0,e.length-i.length);e=s}else if(i){var u=e.indexOf(i);o=e.substring(0,u);e=e.substring(u)}else if(l[a+1]){-1===(u=e.indexOf(l[a+1]))&&(u=e.length);o=e.substring(0,u);e=e.substring(u)}else{if(f.length>a+2){i=f[++a+1];continue}o=e;e=""}break}c[n](o,t)}return t},this.varNames=n,this.template=e}return g.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(e)}},g}),function(e,t){"function"==typeof define&&define.amd?define(["angular","uri-templates","deep-diff"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("angular"),require("uri-templates"),require("deep-diff")):e.ModelFactory=t(e.angular,e.UriTemplate,e.DeepDiff)}(this,function(d,g,v){var e=d.module("modelFactory",[]),b=d.isUndefined,m=d.forEach,y=d.extend,$=d.copy,O=["$$array","$save","$destroy","$pending","$rollback","$diff","$update","$commit","$copy"],x=["actions","instance","list","defaults","pk","stripTrailingSlashes","map"],k=function(r){return m(arguments,function(e){e!==r&&m(e,function(e,n){-1===O.indexOf(n)&&(r[n]?d.isArray(r[n])?r[n].concat(e.filter(function(e){var t=-1!==r[n].indexOf(e);return t&&k(t,e),t})):d.isObject(r[n])?k(r[n],e):r[n]=e:d.isFunction(r[n])||(r[n]=e))})}),r},A=function(n,r){for(var e in m(r=r||{},function(e,t){n.hasOwnProperty(t)||"$"===t.charAt(0)||delete r[t]}),n)n.hasOwnProperty(e)&&"$"!==e.charAt(0)&&(d.isObject(n[e])&&!d.isArray(n[e])?r[e]=A(n[e],r[e]):r[e]=n[e]);return r};return e.provider("$modelFactory",function(){var r=this;r.defaultOptions={prefix:"",pk:"id",stripTrailingSlashes:!0,defaults:{},map:{},actions:{base:{wrap:!0,beforeRequest:void 0,afterRequest:void 0,cache:!1},get:{method:"GET"},query:{method:"GET",isArray:!0},post:{method:"POST",invalidateCache:!0},update:{method:"PUT",invalidateCache:!0},delete:{method:"DELETE",invalidateCache:!0}},instance:{},list:{}},r.$get=["$rootScope","$http","$q","$log","$cacheFactory",function(c,p,h,e,n){return function(o,u){var t={},e=o.split("/"),a=e[e.length-1];function s(n){(n=n||[]).forEach(function(e,t){null!=e&&(n[t]=i(e,n))});var r=n.push;return n.push=function(){for(var e=Array.prototype.slice.call(arguments),t=0;t<e.length;t++)e[t]=i(e[t],n);r.apply(n,e)},u.list&&y(n,u.list),n}u=k({},$(r.defaultOptions),u);var i=function(e,t){var n=e.constructor===l?e:new l(e);return n.$$array=t,n},f=function(e){var t=e.toString();return t=(t=t.substr("function ".length)).substr(0,t.indexOf("("))};function l(n){var r=this,i=[];n=n||{},m(u.defaults,function(e,t){void 0===n[t]&&(n[t]=$("function"==typeof e?e(n):e))}),m(u.map,function(e,t){f(e)===f(l)||f(e)===f(s)?n[t]=new e(n[t]):"function"==typeof e?n[t]=e(n[t],n):(n[t]=n[e],delete n[e])}),m(u.actions,function(e,t){"$"===t[0]&&(r[t]=function(){return l.$buildRequest(t,e,r)})}),y(r,n),y(r,$(u.instance)),r.$save=function(){var n=r[u.pk]?"update":"post",e=l[n](this);return r.$pending=!0,e.then(function(e){r.$pending=!1,e&&r.$update(e);var t="post"===n?"created":"updated";c.$broadcast(a+"-"+t,r),i.push(d.toJson(r))},function(){r.$pending=!1}),e},r.$destroy=function(){var e=l.delete(this);return r.$pending=!0,e.then(function(){r.$pending=!1;var e=r.$$array;e&&e.splice(e.indexOf(r),1),c.$broadcast(a+"-destroyed",r)},function(){r.$pending=!1}),e},r.$diff=function(e){var t=i[e||i.length-1],n=d.toJson(r);return v.diff(JSON.parse(t),JSON.parse(n),function(e,t){return"$"===t[0]})},r.$commit=function(){return i.push(d.toJson(r)),r},r.$rollback=function(e){var t=i[e||i.length-1];return r.$update(JSON.parse(t)),r},r.$update=function(e){return A(e,r),r},r.$copy=function(){var e=d.toJson(this);return new l(d.fromJson(e))},r.$commit()}return l.$cache=n(o),m(u.actions,function(t,n){"base"!==n&&"$"!==n[0]&&(l[n]=function(){var e=Array.prototype.slice.call(arguments);return l.$buildRequest.apply(this,[n,t].concat(e))})}),l.$buildRequest=function(e,t,n,r){var i=$(u.actions.base);y(i,$(t)),!0===i.cache&&(i.cache=l.$cache),i.method=i.method||"GET";var a=u.prefix?u.prefix+"/":"";if(i.override)a=i.url;else if(a+=o,i.url&&(a+=/^(\/|{\/)/.test(i.url)?i.url:"/"+i.url),a=l.$url(a,n,i.method),"get"!==e&&"post"!==e&&"update"!==e&&"delete"!==e||(a+="{/"+u.pk+"}"),"GET"===i.method&&(d.isString(n)||d.isNumber(n))){var s={};s[u.pk]=n,n=s,r&&(i.params=k({},i.params,r))}else"GET"===i.method&&d.isObject(n)&&(i.params=k({},i.params,n));return i.url=l.$url(a,n,i.method),"delete"!==e&&"DELETE"!==i.method&&(i.data=n),l.$call(i)},l.$call=function(n){var e=n.method+":"+n.url+":"+d.toJson(n.params);if(t[e])return t[e];var r=h.defer();return t[e]=r.promise,n.data=$(n.data),n.beforeRequest&&n.beforeRequest(n),n.data=l.$strip(n.data),p(n).then(function(e){if(n.afterRequest){var t=n.afterRequest(e.data);b(t)||(e.data=t)}n.invalidateCache&&l.$cache.removeAll(),e?n.wrap?n.isArray?r.resolve(new l.List(e.data)):r.resolve(new l(e.data)):r.resolve(e.data):r.resolve()},r.reject).finally(function(){t[e]=void 0}),r.promise},l.$url=function(e,n,r){var t=new g(e||o).fill(function(e){var t=n[e];return t?("GET"===r&&delete n[e],t):null});return u.stripTrailingSlashes&&(t=t.replace(/\/+$/,"")||"/"),t},l.$strip=function(n){return n&&"object"==typeof n&&m(n,function(e,t){-1<O.indexOf(t)&&delete n[t]}),n},m(u,function(e,t){-1===x.indexOf(t)&&(l[t]=e)}),l.List=s,l}}]}),e});